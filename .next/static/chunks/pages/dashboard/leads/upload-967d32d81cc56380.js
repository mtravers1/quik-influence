(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5760],{63167:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/leads/upload",function(){return n(76588)}])},76588:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return B}});var r=n(85893),o=n(67294),a=n(25934),i=n(68527),u=n(51273),c=n(79042),l=n(25675),s=n(34051),d=n.n(s),f=n(57460),p=n.n(f),h=n(25617),x=n(48081),m=n(28609),g=n(53329),v=n(76099);function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(r,o)}function w(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){b(a,r,o,i,u,"next",e)}function u(e){b(a,r,o,i,u,"throw",e)}i(void 0)}))}}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var I=function(e,t){var n=(0,o.useState)(0),r=n[0],a=n[1],i=(0,o.useState)([]),u=i[0],c=i[1],l=(0,o.useState)(g.Ih.IDLE),s=l[0],f=l[1],y=(0,o.useState)({startingByte:0,uploadUrl:"".concat(x.gA,"/api/v1/admin/import-leads")}),b=y[0],I=(y[1],(0,o.useState)([])),k=I[0],A=I[1],E=(0,o.useState)(),C=(E[0],E[1]),D=(0,o.useRef)(new AbortController),O=(0,o.useState)(!1),_=O[0],P=(O[1],(0,h.I0)()),R=(0,m.pm)();(0,o.useEffect)((function(){f(g.Ih.PROCESSING),e&&p().parse(e,{worker:!0,complete:function(e){c({headers:e.data[0],data:e.data.slice(1,10),count:e.data.length}),f(g.Ih.IDLE)}})}),[]);var T=function(){var e=w(d().mark((function e(n,r){var o,i,u,c,l,s,p,h,m;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="",!t){e.next=11;break}if("string"!==typeof t){e.next=10;break}return e.next=5,x.be.post("/admin/tag",{name:t});case 5:i=e.sent,P((0,v.zl)(i.data.data)),o=i.data.data.id,e.next=11;break;case 10:o=t.value;case 11:return f(g.Ih.PENDING),u=new FormData,c=new XMLHttpRequest,l=n.slice(r.startingByte),e.prev=15,e.next=18,x.be.post("/admin/leads-upload-request",{fileName:n.name,tagId:o,fileLength:r.fileLength});case 18:s=e.sent,p=s.data.data,h=p.UploadId,m=p.fileName,C(h),u.append("chunk",l,m),c.open("POST",r.uploadUrl,!0),c.setRequestHeader("Content-Range","bytes=".concat(r.startingByte,"-").concat(r.startingByte+l.size,"/").concat(n.size)),c.setRequestHeader("token",localStorage.getItem("_q_inf")||""),c.setRequestHeader("upload-id",h),c.onload=function(e){200===c.status?(f(g.Ih.COMPLETED),a(100)):z()},c.ontimeout=function(e){return z()},c.onerror=function(e){return z()},c.onabort=function(e){return L()},c.upload.onprogress=function(e){var t=r.startingByte+e.loaded;N(t)},c.send(u),e.next=37;break;case 34:e.prev=34,e.t0=e.catch(15),z();case 37:case"end":return e.stop()}}),e,null,[[15,34]])})));return function(t,n){return e.apply(this,arguments)}}(),z=function(){f(g.Ih.FAILED),a(100)},L=function(){f(g.Ih.PAUSED)},N=function(t){f(g.Ih.UPLOADING);var n=e.size;null!==n&&a(Math.round(100*t/n))};(function(){var e=w(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))})(),function(){var e=w(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}(),function(){var e=w(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}();return{status:s,progress:r,cancelUpload:function(){D.current.abort()},parsedData:u,colorStatus:function(){switch(s){case g.Ih.PENDING:return"yellow";case g.Ih.UPLOADING:return"green";case g.Ih.PAUSED:return"yellow";case g.Ih.COMPLETED:return"green";case g.Ih.FAILED:default:return"red"}}(),matchedHeaders:k,setMatchedHeaders:A,processFileAndUpload:function(){f(g.Ih.PROCESSING),p().parse(e,{worker:!0,complete:function(t){if(t.data.splice(0,1),k.some((function(e){return e}))||!k.includes("phone")){var n=t.data.length,r=[k].concat(j(t.data)),o=p().unparse(r),a=new File([o],e.name,{type:"text/csv;charset=utf-8;"});T(a,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){S(e,t,n[t])}))}return e}({},b,{fileLength:n}))}else R({title:"Please include headers in your file",description:"",status:"error",duration:4e3,isClosable:!0,position:"top-right"})}})},fileHeaderError:_}},k=n(20949),A=function(e){var t=e.progress,n=e.color,o=(0,k.If)().colorMode;return(0,r.jsxs)(i.kC,{w:"100%",alignItems:"center",children:[(0,r.jsx)(i.xu,{flexGrow:1,backgroundColor:"dark"===o?"white":"#000",height:"1px",marginRight:"10px",children:(0,r.jsx)(i.xu,{transition:"0.3s ease",width:"".concat(t,"%"),backgroundColor:n||"#000",height:"1px"})}),t,"%"]})},E=n(27030),C=n(2379),D=n(51436),O=n(92814),_=n(83814),P=n(4612),R=function(e,t){var n=(0,o.useState)(""),r=n[0],a=n[1],i=(0,o.useState)(e),u=i[0],c=i[1],l=(0,o.useState)(!1),s=l[0],d=l[1],f=(0,o.useState)(-1),p=f[0],h=f[1],m=(0,o.useRef)(),g=(0,o.useRef)(p),v=(0,o.useRef)(u),y=function(e){g.current=e,h(e)},b=function(e){a(e.name),d(!1),t({target:{value:e}}),y(-1)};(0,o.useEffect)((function(){if(""!==r){var t=e.filter((function(e){return(0,x.kz)(r,e.name)}));c(t),v.current=t}else c(e),v.current=e;return function(){}}),[r,e]),(0,o.useEffect)((function(){return s&&document.body.addEventListener("keydown",w),s||document.body.removeEventListener("keydown",w),function(){document.body.removeEventListener("keydown",w)}}),[s]);var w=function(e){if("ArrowUp"===e.key&&g.current>0&&(e.preventDefault(),y(g.current-1)),"ArrowDown"===e.key&&g.current<v.current.length-1&&(e.preventDefault(),y(g.current+1)),"Enter"===e.key&&(e.preventDefault(),-1!==g.current)){var t=u.filter((function(e,t){return t===g.current}));b(t[0])}};return{handleChange:function(e){var n=e.target.value;a(n),t({target:{value:n}}),y(-1)},handleSelect:b,handleFocus:function(){d(!0)},handleBlur:function(e){!m.current.contains(e.relatedTarget)&&e.target!==m.current&&(d(!1),y(-1))},innerOpts:u,showDropDown:s,parent:m,value:r,activeIndex:p}},T=function(e){var t=e.option,n=e.colorMode,a=e.borderColor,u=e.value,c=e.activeIndex,l=e.handleSelect,s="dark"===n?"rgba(255, 255, 255, 0.6)":"rgba(51, 51, 51, 0.6)",d="dark"===n?"rgba(255, 255, 255, 0.8)":"rgba(51, 51, 51, 0.8)",f="dark"===n?"#333":"#fff",p=c===e.idx,h=u===t.name,x=(0,o.useRef)();return p&&x.current.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),(0,r.jsx)(i.xu,{as:"li",ref:x,borderBottom:"1px solid ".concat(a),padding:"10px",cursor:"pointer",color:h||p?f:void 0,background:h||p?d:void 0,onClick:function(){return l(t)},_hover:{background:s,color:f},children:t.name})},z=function(e){var t=e.options,n=e.onSelect,a=e.placeHolder,u=(0,k.If)().colorMode,c=(0,o.useRef)();(0,o.useEffect)((function(){c.current.setAttribute("autocomplete","off")}),[]);var l=R(t,n),s=l.handleChange,d=l.handleSelect,f=l.handleFocus,p=l.handleBlur,h=l.innerOpts,x=l.showDropDown,m=l.value,g=l.parent,v=l.activeIndex,y="dark"===u?"rgba(255, 255, 255, 0.16)":"#CBD5E0";return(0,r.jsxs)(i.xu,{position:"relative",maxW:"300px",ref:g,zIndex:10,children:[(0,r.jsx)(P.II,{value:m,onChange:s,padding:"10px",fontSize:"16px",height:"auto",onFocus:f,onBlur:p,placeholder:a||"",name:"upload",ref:c}),x&&(0,r.jsx)(i.xu,{as:"ul",listStyleType:"none",border:"1px solid ".concat(y),position:"absolute",width:"100%",top:"45px",bg:_.o5[u],onBlur:p,tabIndex:-1,borderRadius:"5px",maxHeight:"400px",overflowY:"auto",children:h.map((function(e,t){return(0,r.jsx)(T,{option:e,colorMode:u,borderColor:y,value:m,activeIndex:v,handleSelect:d,idx:t},"new_opt_".concat(t))}))})]})};function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var F=function(e){var t,n,a=e.file,u=e.headers,s=e.removeFile,d=e.id,f=(0,h.v9)((function(e){return e.generals})).tags,p=(0,o.useState)(f.map((function(e){return{name:e.name,value:e.id}})))[0],m=(0,o.useState)(),v=m[0],y=m[1],b=I(a,v),w=b.progress,S=b.status,j=(b.cancelUpload,b.parsedData),k=b.colorStatus,P=b.matchedHeaders,R=b.setMatchedHeaders,T=b.processFileAndUpload,L=b.fileHeaderError;(0,o.useEffect)((function(){R(function(){var e,t=N(u);return null===j||void 0===j||null===(e=j.headers)||void 0===e?void 0:e.map((function(e){for(var n,r=function(n){if(!t[n])return"continue";if((0,x.hY)(t[n],e)>.7){var r=t[n];return t=t.filter((function(e,t){return n!==t})),{v:r}}},o=0;o<u.length;o++){var a=r(o);if("continue"!==a&&"object"===((n=a)&&"undefined"!==typeof Symbol&&n.constructor===Symbol?"symbol":typeof n))return a.v}}))}()||[])}),[null===j||void 0===j?void 0:j.headers]);var F=[{label:"",value:""}].concat(N(u.map((function(e){return{label:e,value:e,style:P.includes(e)?{display:"none"}:{}}}))));return(0,r.jsxs)(i.xu,{width:"100%",children:[(0,r.jsxs)(i.kC,{justifyContent:"space-between",alignItems:"center",margin:"30px 0 15px 0",height:"",children:[(0,r.jsxs)(i.kC,{alignItems:"center",children:[(0,r.jsx)(i.xu,{fontWeight:500,fontSize:"16px",as:"h1",whiteSpace:"nowrap",marginRight:"20px",children:"Data Sample"}),(S===g.Ih.IDLE||S===g.Ih.PROCESSING)&&(0,r.jsx)("button",{style:{padding:"0 10px"},onClick:T,children:(0,r.jsx)(O.G,{icon:D.cf$,color:_.ZP.influenceRed,style:{width:"16px",height:"16px"}})}),S!==g.Ih.UPLOADING&&(0,r.jsx)("button",{style:{padding:"0 10px"},onClick:function(){s(d)},children:(0,r.jsx)(O.G,{icon:D.$aW,color:_.ZP.influenceRed,style:{width:"16px",height:"16px"}})})]}),S===g.Ih.PROCESSING&&(0,r.jsxs)(i.xu,{position:"relative",fontSize:"16px",paddingRight:"40px",children:["Processing Your data",(0,r.jsx)(i.xu,{position:"absolute",right:0,top:"50px",transform:"translateY(-60px)",width:"40px",height:"40px",children:(0,r.jsx)(l.default,{src:C.Z,alt:"",width:40,height:40})})]}),!(S===g.Ih.IDLE||S===g.Ih.PROCESSING)&&(0,r.jsxs)(i.kC,{fontSize:"13px",children:[(0,r.jsxs)(i.xu,{fontSize:"13px",as:"p",marginRight:"20px",children:["Status:",(0,r.jsx)(i.xu,{as:"span",marginLeft:"10px",color:k,textTransform:"capitalize",fontWeight:"bold",children:S})]}),(0,r.jsxs)(i.kC,{w:"200px",children:[(0,r.jsx)(i.xu,{as:"p",marginRight:"15px",children:"Progress:"}),(0,r.jsx)(A,{progress:w,color:k})]})]})]}),(0,r.jsx)(z,{options:p||[],onSelect:function(e){y(e.target.value)},placeHolder:"Tag your data"}),L&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i.xu,{margin:"30px 0 30px",children:[(0,r.jsx)(i.xu,{marginBottom:"5px",fontSize:"16px",children:"The file uploaded doesn't comform to our standard table format"}),(0,r.jsxs)(i.xu,{fontWeight:"500",whiteSpace:"pre-wrap",children:["The table headers are too many, your headers should not be more than"," ",(0,r.jsx)(i.xu,{color:"red",as:"span",children:u.length}),"\n","We will try to match your headers as closey as possible to our own, and will give you a drop down to choose from our list of headers"]}),(0,r.jsx)(i.xu,{as:"p",marginTop:"20px",children:"Here is a sample Header"})]}),(0,r.jsx)(i.xu,{overflowX:"auto",width:"100%",padding:"10px 0 10px",children:(0,r.jsx)(c.iA,{children:(0,r.jsx)(c.hr,{children:(0,r.jsx)(c.Tr,{children:null===u||void 0===u?void 0:u.map((function(e,t){return(0,r.jsx)(c.Th,{fontSize:"16px",textTransform:"initial",fontFamily:"Avenir",whiteSpace:"nowrap",minWidth:"200px",padding:"10px 15px 10px 0",children:e},"lead_data_hd_".concat(t))}))})})})})]}),!L&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.xu,{overflowX:"auto",width:"100%",padding:"10px 0",children:(0,r.jsxs)(c.iA,{children:[(0,r.jsx)(c.hr,{children:(0,r.jsx)(c.Tr,{children:null===j||void 0===j||null===(t=j.headers)||void 0===t?void 0:t.map((function(e,t){return(0,r.jsx)(c.Th,{fontSize:"16px",textTransform:"initial",fontFamily:"Avenir",whiteSpace:"nowrap",minWidth:"200px",padding:"10px 15px 10px 0",children:(0,r.jsx)(E.Z,{onChange:function(e){return function(e,t){R((function(n){var r=N(n);return r[t]=e.target.value,r}))}(e,t)},placeholder:"choose header",name:"header",options:F,selected:P[t]})},"lead_data_hd_".concat(t))}))})}),(0,r.jsx)(c.p3,{children:null===j||void 0===j||null===(n=j.data)||void 0===n?void 0:n.map((function(e,t){return(0,r.jsx)(c.Tr,{children:e.map((function(e,n){return(0,r.jsx)(c.Td,{whiteSpace:"nowrap",textTransform:"capitalize",fontSize:"13px",padding:"10px 15px 10px 0",children:e},"lead_data_td_".concat(t).concat(n))}))},"lead_data_tr_".concat(t))}))})]})}),(0,r.jsxs)(i.xu,{textAlign:"right",fontWeight:"500",marginTop:10,as:"h2",children:["Data Count: ",null===j||void 0===j?void 0:j.count]})]})]})};function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function H(e){return function(e){if(Array.isArray(e))return U(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var B=function(){var e=(0,h.v9)((function(e){return e.generals})).formData,t=(0,o.useState)([]),n=t[0],c=t[1],l=(0,o.useState)(e.map((function(e){return e.name})))[0],s=(0,o.useRef)(),d=function(e){c((function(t){return t.filter((function(t){return e!==t.id}))}))};return(0,r.jsx)(u.Z,{children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i.xu,{margin:"30px 0 30px",children:[(0,r.jsx)(i.xu,{marginBottom:"5px",fontSize:"16px",children:"Click on the button to upload file. You can upload multiple files"}),(0,r.jsxs)(i.xu,{fontWeight:"500",whiteSpace:"pre-wrap",children:["Your headers should not be more than ",l.length,"\n","We will try to match your headers as closey as possible to our own, and will also give you a drop down to choose from our list of headers"]})]}),(0,r.jsxs)(i.xu,{width:"100%",children:[(0,r.jsx)(i.xu,{children:(0,r.jsxs)(i.xu,{as:"label",htmlFor:"upload-btn",style:{cursor:"pointer"},fontSize:"16px",padding:"5px 10px",border:"1px solid #000",borderRadius:"5px",children:["Choose a File",(0,r.jsx)("input",{ref:s,id:"upload-btn",type:"file",accept:".csv",style:{display:"none"},onChange:function(e){var t=(null===e||void 0===e?void 0:e.target).files;c((function(e){return H(e).concat([{data:t[0],id:(0,a.Z)()}])})),s.current.value=null}})]})}),H(n).reverse().map((function(e){return(0,r.jsx)(F,{file:e.data,id:e.id,removeFile:d,headers:l},e.id)}))]})]})})}}},function(e){e.O(0,[8523,8527,3588,3084,3061,5715,6345,5787,6636,2429,9946,550,1273,9774,2888,179],(function(){return t=63167,e(e.s=t);var t}));var t=e.O();_N_E=t}]);